/**
 * Backbone.Composite v0.1.0
 * https://github.com/DreamTheater/Backbone.Composite
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
!function(a){"use strict";var b=Backbone.Composite=function(c){return this instanceof b?(a=_.extend(this,{view:c},{components:{}}),_.extend(c,{render:_.wrap(c.render,function(b){return b.call(this),a.renderComponents(),this}),remove:_.wrap(c.remove,function(b){return a.removeComponents(),b.call(this),this})}),void 0):new b(c)};_.extend(b.prototype,{constructor:b,add:function(a,b){var c;return!a||_.isObject(a)?c=a:(c={})[a]=b,_.each(c,function(a,b){var c=a.view;this.components[b]=a,this.view.listenTo(c,"all",function(a){var b=Array.prototype.slice.call(arguments,1);b.unshift(a,c),this.trigger.apply(this,b)})},this),this.refresh(),this},refresh:function(){return this.view.render(),this},renderComponents:function(){var a=this.components;return _.each(a,function(a){var b=a.view,c=this._resolveElement.call({view:this.view,options:a});b.setElement(c).render()},this),this},removeComponents:function(){var a=this.components;return _.each(a,function(a){var b=a.view;b.remove()}),this},_resolveElement:function(){var a=this.options.selector,b=this.view;return _.isFunction(a)&&(a=a.call(b)),a?b.$(a):b.$el}})}();