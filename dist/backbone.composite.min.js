/**
 * Backbone.Composite v0.1.1
 * https://github.com/DreamTheater/Backbone.Composite
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
!function(a){"use strict";var b="object"==typeof module&&"object"==typeof exports,c=b?{_:require("underscore"),Backbone:require("backbone")}:window;(b?exports:Backbone).Composite=a(c,b)}(function(a){"use strict";var b,c=a._,d=a.Backbone,e=d.Composite=function(a){return this instanceof e?(b=c.extend(this,{view:a},{components:{}}),c.extend(a,{render:c.wrap(a.render,function(a){return a.call(this),b.refresh(),this}),remove:c.wrap(a.remove,function(a){return b.removeComponents(),a.call(this),this})}),void 0):new e(a)};return c.extend(e.prototype,{constructor:e,add:function(a,b){var d;return!a||c.isObject(a)?d=a:(d={})[a]=b,c.each(d,function(a,b){var d=a.view,e=a.selector;this.components[b]=c.extend(d,{selector:e||null}),this.view.listenTo(d,"all",function(a){var b=Array.prototype.slice.call(arguments,1);b.unshift(a,d),this.trigger.apply(this,b)})},this),this.refresh(),this},refresh:function(){return this.renderComponents(),this},renderComponents:function(){var a=this.components;return c.each(a,function(a){var b=this._resolveElement.call({view:this.view,selector:a.selector});a.setElement(b).render()},this),this},removeComponents:function(){var a=this.components;return c.each(a,function(a){a.remove()}),this},_resolveElement:function(){var a=this.view,b=this.selector;return c.isFunction(b)&&(b=b.call(a)),b?a.$(b):a.$el}}),e});